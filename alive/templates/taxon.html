{% extends 'base.html' %}

{% block content %}

<h2>
  {{ taxon.name }}

  <form class="ajax pull-right" id="follow-form" method="post" action=".">
    <button class="btn success" type="submit">Follow</button>
    <input name="follow" value="{{ taxon.id }}" type="hidden" id="">
  </form>
</h2>

<div class="row" id="taxon-info">

  <div class="span8" id="taxon-status">
    <ul class="media-grid">
      <li>
      <a href="#">
        <img class="thumbnail" src="" alt="IMAGE" width="210" height="115">
      </a>
      </li>
    </ul>
  </div>

  <div class="span8" id="query-status">
    <h3>Stats</h3>
    <p>
    {% if last_query %}
    <span class="label">Results</span> {{ last_query.total_results }}{% if not last_query.total_results == 0 %} ({{ fetch_ratio }}% fetched){% endif %} <span class="label">Last updated</span> {{ last_query.timestamp }} <br>
    {% else %}
    <span class="label">Results</span> None, yet. <span class="label">Last updated</span> Never.<br>
    {% endif %}
    </p>
    {% if fetching %}
    <div class="alert-message warning fade in" data-alert="alert">
      <p>References are being fetched right now (it might take a while). <span id="loading" style="display:inline;"></span></p>
    </div>
    {% endif %}
  </div>

</div>

<div id="reference-list">
    <h3>References</h3>

    {% if articles %}

    <table id="references-table" class="zebra-striped">
      <thead>
        <tr>
          <th>Year</th>
          <th>Title</th>
          <th>Authors</th>
          <th>Publication</th>
          <th>Type</th>
          <th>Readers</th>
        </tr>
      </thead>
      <tbody>
        {% for article in articles %}
        <tr>
          <td> {{ article.year }} </td>
          <td> {{ article.title }} </td>
          <td> {% for author in article.authors.all %}{{ author.surname }} {{ author.forename|first }}{% if not forloop.last %}, {% endif %}{% endfor %} </td>
          <td>
            <em>{{ article.publication_outlet }}</em>, {{ article.volume }}{% if article.issue %}({{ article.issue }}){% endif %}, {{ article.pages }}p{% if article.chapter %}, {{ article.chapter }}{% endif %}
          </td>
          <td> {{ article.type }} </td>
          <td> {{ article.stats.readers }} </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% else %}

        {% if taxon.total_results == 0 %}
        Sorry, we could not find any articles about <strong>{{ taxon.name }}</strong>.
        {% else %}
        Fetching articles for <strong>{{ taxon.name }}</strong>... Please come back soon.
        {% endif %}

    {% endif %}

</div>

{% comment %}
<div class="grid_3 omega" id="side-info">
    <div id="top-authors">
        <h3>Active authors</h3>
        <table>
            <tr class="header-row">
                <th>Author</th>
                <th>Publications</th>
            </tr>

            {% for author in top_authors %}
            <tr class="{% cycle 'dark-row' 'light-row' %}">
                <td>{{ author.authors__surname }}, {{ author.authors__forename }}</td>
                <td>{{ author.authors__count }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endcomment %}

{% endblock %}
